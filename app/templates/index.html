{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}

<div class="content">
    <h1 class="gameHeader">Zahlenraten</h1>
    {% if result and result == "too low" %}
        <span class="userInputPrompt">Zu niedrig!<br/>Gib eine Zahl ein, um zu raten:</span>
    {% elif result and result == "too high" %}
        <span class="userInputPrompt">Zu hoch!<br/>Gib eine Zahl ein, um zu raten:</span>
    {% else %}
    <span class="userInputPrompt">Gib eine Zahl ein, um zu raten:</span>
    {% endif %}
    <div class="form-container">
    <form action="{{ url_for('main.guess') }}" method="post" id="guessForm">
        <input name="guess" id="guessInput" type="number" class="userInput" placeholder="###" min="0" max="100"/>
        <div class="button-row">
            <button name="action" value="guess" class="guessBtn disabled" id="guessBtn" disabled>
                {% if guesses and guesses|length > 0 %}Raten{% else %}Spiel starten{% endif %}
            </button>
            <button type="submit" name="action" value="restart" class="restartBtn{% if not (guesses and guesses|length > 0) %} invisible-btn{% endif %}">Neues Spiel</button>
        </div>
    </form>
    </div>
    <script>
    const guessInput = document.getElementById('guessInput');
    const guessBtn = document.getElementById('guessBtn');
    const guessForm = document.getElementById('guessForm');
    guessInput.addEventListener('input', function() {
        if (guessInput.value && !isNaN(guessInput.value)) {
            guessBtn.classList.remove('disabled');
            guessBtn.disabled = false;
        } else {
            guessBtn.classList.add('disabled');
            guessBtn.disabled = true;
        }
    });
    guessInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !guessBtn.disabled) {
            e.preventDefault();
            guessBtn.click();
        }
    });
    window.addEventListener('DOMContentLoaded', function() {
        guessInput.focus();
    });
    </script>
    {% if not guesses or guesses|length == 0 %}
    <div class="scoreboard">
        <span class="scoreboardHeader">Highscores</span>
        {% if scores and scores|length > 0 %}
            {% for u in scores %}
            <div class="scoreboardEntry">
                <span class="scoreboardEntryNumber">{{ loop.index }}.</span>
                <span class="scoreboardEntryName">{{ u.username }}</span>
                <span class="scoreboardEntryScore">{{ u.points }}</span>
            </div>
            {% endfor %}
        {% else %}
            <div class="scoreboardEntry">
                <span class="scoreboardEntryName">Noch keine Highscores.</span>
            </div>
        {% endif %}
    </div>
    {% endif %}
    <div class="adsPopup">
        <video src="https://cdn.mtdv.me/video/rick.mp4" controls autoplay muted id="vid" width="100%" height="100%">adsPopupFrame"></video>
        <button class="closePopupBtn" id="btn">á°½</button>
    </div>
    {% if guesses %}
        <div class="recent-guesses">
            <h3>Bisher geratene Zahlen:</h3>
            <span>
                {{ guesses|join(', ') }}
            </span>
        </div>
    {% endif %}
</div>
<script>
    function close_ad() {
        document.querySelector('.adsPopup').style.display = 'none';
        // stop video playback
        var video = document.getElementById('vid');
        video.pause();
        video.currentTime = 0;
    }
    function show_ad() {
        document.querySelector('.adsPopup').style.display = 'block';
        var video = document.getElementById('vid');
        video.play();
    }

    document.addEventListener("DOMContentLoaded", () => {

        document.getElementById('btn').addEventListener('click', function () {
            close_ad();
        });

        const video = document.getElementById("vid");
        const count_guesses = "{{ count_guesses | default(0)}}";  // Flask variable

        if (count_guesses % 8 == 7) {
            show_ad();
            console.log("Ad shown");
        }
    });
</script>
{% endblock %}
